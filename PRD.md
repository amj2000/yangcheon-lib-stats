# [PRD] 양천구립도서관 프로그램 실시간 통계 관리 시스템

**제품 요구사항 정의서 (Product Requirements Document)**  
완성 버전 기준

---

## 1. 문서 정보

| 항목 | 내용 |
|------|------|
| **문서 목적** | 프로그램 운영 통계를 현장에서 입력·수정하고, 총괄 담당자가 실시간으로 참여 현황을 파악할 수 있는 시스템의 제품 요구사항 정의 |
| **대상 독자** | 도서관 내부 보고 라인(총괄, 관리자), 실무 담당자, 개발·운영 담당자 |
| **기준 버전** | 완성된 웹 앱 + Google Apps Script 백엔드 연동 버전 |

---

## 2. 프로젝트 개요

- **명칭:** 양천구립도서관 프로그램 실시간 통계 관리 시스템
- **목적**
  - 프로그램 회차별 모집·참여·노쇼를 현장에서 즉시 입력
  - 입력·수정 이력과 입력자·변경사유를 구글 시트에 저장해 추적 가능하게 함
  - 11개 도서관 전체 현황을 대시보드로 실시간 확인
- **통계 관리 범위:** 11개 도서관  
  양천중앙, 갈산, 개울건강, 목마교육, 미감, 방아다리문학, 신월음악, 영어특성화, 해맞이역사, 새아름작은도서관, 모새미작은도서관

---

## 3. 사용자 및 역할

| 역할 | 설명 | 주요 행동 |
|------|------|------------|
| **현장 담당자** | 도서관별 1명 이상 | 로그인 → 소속 도서관·프로그램 선택 → 회차별 모집/참여/노쇼 입력·제출, 과거 회차 수정 시 변경사유 입력 |
| **총괄 담당자** | 문화기획/관리 | 대시보드에서 11개 도서관 전체 현황 확인, 구글 시트 다운로드/공유 |
| **관리자** | 시스템 운영 | 사용자관리 시트에서 회원 승인, 프로그램목록·입력기록 시트 관리 |
| **일반 사용자** | 승인 전 가입자 | 회원가입 후 관리자 승인 대기, 승인 후 로그인 가능 |

---

## 4. 데이터 원천(구글 시트)

| 시트명 | 용도 | 비고 |
|--------|------|------|
| **사용자관리** | 회원가입·로그인 | 소속 도서관, 이름, 비밀번호, 승인 상태, 역할(일반/관리자) |
| **프로그램목록** | 프로그램 마스터 | 도서관명, 프로그램명, 시작일, 종료일, 운영요일, 운영시간, 총운영회수 등 |
| **입력기록** | 회차별 입력·수정 이력 | 타임스탬프, 도서관명, 프로그램명, 총운영회수, 현재회차, 운영일자, 모집/참여/노쇼, 참여율, 변경사유, **입력자** |

---

## 5. 핵심 기능 요구사항 (완성 기준)

### 5.1 회원가입·로그인

- **회원가입:** 소속 도서관, 이름, 비밀번호 입력 → 사용자관리 시트에 저장, 관리자 승인 전까지 로그인 불가
- **로그인:** 소속 도서관, 이름, 비밀번호로 인증 → 성공 시 통계 입력 페이지로 이동
- **접근 제어:** 통계 입력 페이지는 로그인 필수; 미로그인 시 로그인 페이지로 리다이렉트

### 5.2 프로그램 목록

- **출처:** **프로그램목록** 시트에서만 조회 (입력기록 시트 사용 안 함)
- **시트 구조:** A=도서관명, B=프로그램명, C=시작일, D=종료일, E=운영요일, F=운영시간, G=총운영회수 등
- **통계 입력 화면:** 로그인 사용자의 소속 도서관이 도서관 드롭다운에 자동 선택되고, 해당 도서관의 프로그램만 프로그램 드롭다운에 표시

### 5.3 회차별 통계 입력

- **흐름:** 도서관 선택(자동 선택 가능) → 프로그램 선택 → 참여 현황(모집/참여/노쇼) 입력 → 제출
- **모집 인원**
  - 1회차: 반드시 입력. 동시에 「총 운영 회수」 입력
  - 2회차 이후: 이전 회차 모집 인원 이상만 입력 가능. 수정은 가능하나 감소 불가
  - 모집 인원을 이전보다 늘리는 경우(인원 증액): **증액 사유** 필수 입력
- **검증:** 참여 ≤ 모집, 노쇼 ≤ (모집 − 참여)
- **제출 시:** 입력기록 시트에 저장하며, **입력자** 컬럼에 로그인한 사용자 이름 저장

### 5.4 이전 회차 운영 기록(히스토리)

- **표시:** 선택한 도서관·프로그램에 대해 이전 회차 기록을 리스트로 표시 (회차, 날짜, 모집/참여/노쇼, 참여율, 변경사유)
- **수정:** 리스트 항목 클릭 시 과거 회차 수정 모달 표시
  - 수정 가능 항목: 운영일자, 모집(명), 참여(명), 노쇼(명)
  - **변경사유 필수:** 수정 저장 시 변경사유 입력 필수
  - **변경사유 형식:** `[변경한 항목] 변경사유(수정자이름), 수정일시`  
    예: `[참석자수] 입력오류(안미정), 20260101 10:10:00`
  - 입력기록 시트 **변경사유** 컬럼에 위 형식으로 **누적** 저장 (여러 번 수정 시 여러 줄로 누적)
  - 도서관별 사용자가 2명 이상일 수 있으므로 **누가 수정했는지** 기록

### 5.5 대시보드

- **데이터 출처:** 입력기록(또는 통계) 시트
- **구성**
  - 4대 지표 카드: 총 프로그램 수, 전체 누적 모집, 전체 누적 참여, 전체 누적 노쇼
  - 도서관별 막대 차트: 지표 탭(프로그램 수 / 모집 인원 / 참여자 수 / 노쇼) 전환
  - 공공도서관(9개소)·작은도서관(2개소) 구분 카드
- **로딩:** 캐시 우선 표시 후 백그라운드 갱신으로 빠른 첫 화면

### 5.6 사용자 경험·안내

- **로딩 표시:** 스피너를 「점 3개가 순서대로 튀는」 애니메이션으로 통일 (오류 아이콘과 혼동 방지)
- **안내 문구:** 사용자에게 노출되는 메시지에서 「오류」「에러」 문구 제거, 안내만 표시 (예: 가입 완료·승인 대기, 연결 불가 시 「연결할 수 없습니다. 다시 시도해 주세요.» 등)

---

## 6. 업무 프로세스(요약)

1. **회원가입** → 사용자관리 시트 저장 → 관리자 승인
2. **로그인** → 사용자관리 시트 검증 → 통계 입력 페이지 진입
3. **통계 입력**  
   도서관(자동 선택 가능) → 프로그램 선택 → 1회차 시 총 운영회수 입력 → 모집/참여/노쇼 입력(증액 시 사유 입력) → 제출 → 입력기록 시트 저장(입력자 포함)
4. **과거 회차 수정**  
   히스토리 항목 클릭 → 모달에서 날짜·모집·참여·노쇼 수정 + 변경사유 입력 → 저장 → 입력기록 시트 해당 행 갱신, 변경사유 컬럼에 형식에 맞게 누적
5. **대시보드**  
   입력기록 시트 조회 → 4대 지표·차트·카드 갱신

---

## 7. 성공 기준(완성 버전 반영)

- 로그인한 사용자 소속 도서관이 통계 입력 화면에서 자동 선택된다.
- 프로그램 목록은 프로그램목록 시트 기준으로 해당 도서관만 필터링되어 표시된다.
- 모집 인원은 1회차 필수, 2회차부터 이전 회차 이상만 허용되며, 증액 시 사유가 필수이다.
- 과거 회차 수정 시 변경사유가 필수이며, 입력기록 시트에 `[항목] 사유(수정자), 수정일시` 형식으로 누적 저장된다.
- 제출 시 입력자(로그인 사용자 이름)가 입력기록 시트에 저장된다.
- 대시보드는 입력기록 시트 기반으로 실시간 지표·차트를 표시한다.

---

## 8. 미구현·향후 검토 항목

- **알림톡(카카오톡)** 발송: 프로그램 종료 시점 알림 발송은 미구현. 필요 시 별도 연동 검토.
- **링크 토큰 기반 자동 채움:** URL 파라미터로 프로그램 자동 선택 등은 미구현.
- **날짜 필터:** 대시보드 기간/도서관 필터는 현재 전체 기준.
