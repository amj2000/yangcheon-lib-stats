## [PRD] 양천구립도서관 독서문화프로그램 **실시간 통계 관리 시스템**

### 1) 문서 정보

- **문서 목적:** 독서문화프로그램 운영 통계를 *프로그램 종료 직후* 현장에서 입력받아, 총괄 담당자가 **실시간으로 참여 현황**을 파악하고 보고 효율을 높이기 위함
- **대상 독자:** 도서관 내부 보고 라인(총괄, 관리자), 실무 담당자, 개발 담당(외주/내부)

---

### 2) 프로젝트 개요 (Overview)

- **명칭:** 양천구립도서관 독서문화프로그램 실시간 통계 관리 시스템
- **목적(Why):**
    - 기존 엑셀 기반 통계 취합의 한계(지연, 누락, 취합 부담)를 해소
    - 프로그램 종료 직후 담당자가 모바일에서 즉시 입력하도록 유도하여 **지연 없는 현황 파악** 가능
- **통계 관리 범위(Where): 11개 도서관 전체**
    - 양천중앙도서관
    - 갈산도서관
    - 개울건강도서관
    - 목마교육도서관
    - 미감도서관
    - 방아다리문학도서관
    - 신월음악도서관
    - 영어특성화도서관
    - 해맞이역사도서관
    - 새아름작은도서관
    - 모새미작은도서관

---

### 3) 목표 및 성공 기준 (Goals & Success Metrics)

- **프로젝트 목표(핵심)**
    - **정확한 데이터 수집:** 관리자가 관리하는 “마스터 데이터(도서관/프로그램/운영기간/요일/시간)”를 기준으로 현장 담당자는 *선택 입력*만 하도록 하여 **오타·명칭 불일치 등 데이터 오류를 원천 차단**한다.
    - **현장 편의성:** 현장 담당자가 도서관을 선택하면 해당 도서관의 **현재 운영 중인 프로그램만 자동 노출**하여, 입력 시간을 최소화한다.
- **성공 기준(예시)**
    - 현장 입력 화면에서 자유 텍스트 입력을 최소화하고(선택형 위주), 마스터 기준 값만 저장된다.
    - 도서관 선택 시 프로그램 목록이 지연 없이 필터링되어(종속형) 표시된다.
    - “오늘 날짜 기준 운영 중”이 아닌 프로그램은 목록에 노출되지 않는다.
    - 모바일(카카오톡 링크 진입)에서 엄지손가락만으로 입력이 완료된다.
    - (운영 KPI 예시) 프로그램 종료 후 **30분 이내 입력률 90% 이상**
    - (운영 KPI 예시) 입력 누락 건수 월 **X건 이하**(운영 1개월 후 기준치 설정)

---

### 4) 사용자 및 역할 (Users & Roles)

- **현장 담당자(도서관별):**
    - 알림톡 수신 → 링크 클릭 → 통계 입력(모집/참여/노쇼)
- **총괄 담당자(문화기획/관리):**
    - 11개 도서관 전체 현황을 대시보드로 확인
    - 필요 시 구글 시트 다운로드/공유
- **시스템 관리자(운영/개발):**
    - 알림톡 발송 연동 및 템플릿 관리
    - 구글 시트 구조 관리, 장애 대응

---

### 5) 핵심 기능 요구사항 (Key Requirements)

### A. 마스터 DB 관리(관리자)

- **기능 설명:** 관리자가 “도서관별 프로그램 운영 정보”를 **마스터 데이터**로 관리하고, 현장 입력은 이 마스터를 기반으로만 가능하도록 한다.
- **마스터 필드(요구):**
    - 도서관명
    - 프로그램명
    - 기간(시작일~종료일)
    - 요일
    - 시간
- **운영 방식(초기):** Excel 또는 Google Sheets로 관리
- **최소 요구사항**
    - 마스터 데이터는 *단일 원천(Single Source of Truth)* 으로 관리된다.
    - 현장 입력에서 도서관/프로그램을 자유 입력하지 않고 **선택형**으로만 제공한다.

### B. 종속형 드롭다운(현장 입력)

- **기능 설명:** 현장 담당자가 ‘도서관’을 선택하면, ‘프로그램’ 목록이 **실시간으로 필터링되어** 해당 도서관의 프로그램만 표시된다.
- **최소 요구사항**
    - 도서관 선택 → 프로그램 목록 자동 갱신
    - 프로그램 목록은 마스터 데이터를 기준으로 생성된다.
    - 모바일에서 조작이 쉬운 UI(큰 터치 영역, 스크롤 최소화)

### C. 실시간 날짜 필터링(운영 중 프로그램만 노출)

- **기능 설명:** 프로그램 기간(시작~종료)이 **오늘 날짜를 포함하는 경우에만** 프로그램 목록에 노출한다.
- **최소 요구사항**
    - 기본 노출 조건: `시작일 ≤ 오늘 ≤ 종료일`
    - “운영 중이 아닌 프로그램”은 선택 목록에서 자동 제외된다.

### D. 카카오톡 링크 기반 모바일 최적화(엄지 UI)

- **기능 설명:** 현장 담당자가 카카오톡 링크로 접속했을 때, **엄지손가락만으로 입력을 완료**할 수 있는 Mobile First UI를 제공한다.
- **최소 요구사항**
    - 링크 클릭 즉시 입력 화면 진입(로그인 정책은 운영 정책으로 별도 정의 가능)
    - 큰 버튼/큰 입력창
    - 입력 흐름 단계 최소화(선택 → 숫자 입력 → 제출)
    - 제출 완료 확인 화면 제공

### E. (기존 요구) 카카오톡 자동 알림(알림톡)

- **기능 설명:** 프로그램 종료 시간에 맞춰 담당자에게 **통계 입력 링크** 포함 알림톡 발송
- **최소 요구사항**
    - 프로그램 종료 시각 기준 자동 발송(스케줄링)
    - 발송 실패/미전송 내역 확인 가능(운영 관점)
    - 메시지 템플릿에 *프로그램명/일시/도서관명* 등 핵심 정보 포함

### F. (기존 요구) 실시간 대시보드(총괄)

- **기능 설명:** 11개 도서관의 참여/노쇼 등을 차트로 시각화하여 즉시 확인
- **대시보드 최소 구성(예시)**
    - 도서관별 참여율 비교(바 차트)
    - 전체 합계: 모집/참여/노쇼 요약 KPI 카드
    - 기간/도서관 필터(선택)
- **시각화 라이브러리:** Chart.js

### G. (기존 요구) 구글 스프레드시트 연동(데이터 저장/다운로드)

- **기능 설명:** 모든 입력 데이터를 Google Sheets에 실시간 저장하고, 필요 시 다운로드/공유 가능
- **최소 요구사항**
    - 입력 데이터는 즉시 시트에 기록
    - 총괄 담당자가 시트를 기반으로 내부 보고 자료로 활용 가능

---

## 6) 업무 프로세스(Flowchart) — **알림톡 발송 포함 단계별 설명**

아래는 “프로그램 종료 → 알림톡 → 입력 → 저장 → 대시보드 반영”까지의 표준 흐름입니다.

1. **사전 등록(관리/운영)**
    - 프로그램 기본정보(도서관명, 프로그램명, 일정/종료시각, 담당자 연락처, 입력 링크 생성 규칙)를 시스템에 등록한다.
2. **프로그램 진행(현장)**
    - 현장에서 프로그램이 진행된다.
3. **종료 시각 도래(시스템 트리거)**
    - 프로그램 종료 시각이 되면 스케줄러가 해당 프로그램을 조회한다.
4. **알림톡 발송(카카오톡 Messaging API)**
    - 시스템이 담당자에게 알림톡을 발송한다.
    - 알림톡에는 다음이 포함된다.
        - 도서관명 / 프로그램명 / 회차(일시)
        - 통계 입력 링크(해당 프로그램에 매핑된 URL)
5. **담당자 링크 클릭(모바일)**
    - 담당자가 알림톡 링크를 클릭한다.
6. **무로그인 입력 페이지 진입**
    - 별도 로그인 없이 입력 폼이 열린다.
    - (필요 시) 링크 토큰으로 프로그램 정보가 자동 채워진다.
7. **통계 입력 및 제출**
    - 모집/참여/노쇼 값을 입력하고 제출한다.
    - 제출 완료 메시지를 표시한다.
8. **Google Sheets 저장**
    - 입력 데이터가 Google Sheets API를 통해 시트에 즉시 기록된다.
9. **대시보드 실시간 반영**
    - 대시보드는 시트 데이터를 읽어 차트/요약 지표를 갱신한다.
10. **예외 처리(운영)**
    - 알림톡 실패, 링크 오류, 입력 누락 등 발생 시 운영자가 로그/시트를 통해 확인 후 조치한다.

---

# [TRD] 기술 명세서 (Technical Requirements)

## 1) 시스템 구성 개요

- **Frontend:** 관리자 대시보드(웹) + 담당자 입력 페이지(모바일)
    - 기술: **HTML5, CSS3(Glassmorphism), JavaScript(ES6+)**
- **API:** Google Sheets API (**Master Data 연동**)
- **Data Layer(초기 운영):** Google Sheets (마스터/입력 데이터 저장)
- **Notification:** KakaoTalk Messaging API (비즈니스 알림톡)
- **Hosting:** Vercel(또는 Netlify 등)

---

## 2) 기술적 요구사항 & 디자인 원칙 (표)

| 구분 | 요구사항 | 세부 기준 / 체크포인트 |
| --- | --- | --- |
| 프론트엔드 | HTML5, CSS3(Glassmorphism), JavaScript(ES6+) | Flexbox/Grid로 반응형 구성. Mobile First. 반투명 카드/블러(Glassmorphism) 스타일 적용. |
| UI 애니메이션 | CSS3 Transition/Animation (부드러운 전환) | 과하지 않게 “부드러운 전환” 중심. 로딩/카드 등장 등 핵심 구간만. |
| 데이터 시각화 | Chart.js 사용 | 도서관별 비교 차트, 합계 KPI 카드, 필터(기간/도서관) 확장 가능 구조. |
| API | Google Sheets API (Master Data 연동) | 마스터 데이터 조회(도서관→프로그램 종속 목록) + 입력 데이터 저장(append/update). 권한/키 관리 필요. |
| 데이터 저장소 | Google Sheets | 초기 운영은 시트 기반. 마스터/입력 시트를 분리 운영. 컬럼 정의 고정. |
| 알림(핵심) | KakaoTalk Messaging API(알림톡) | 종료 시각 스케줄링, 템플릿 관리, 발송 실패 로그/재발송 정책 정의. |
| 호스팅/배포 | Vercel 배포 | 파일명/경로명은 모두 소문자. 환경변수로 API 키 분리. |
| 디자인 컨셉 | 실리콘 밸리 테크 스타일 (Google I/O 감성) | 반투명 UI(Glassmorphism), 가독성 높은 타이포, 카드 기반 레이아웃, 여백 중심. |
| 디자인 원칙 | 업무용 대시보드 가독성 최우선 | 색상은 절제된 베이스 + 포인트 컬러. 차트는 범례/단위 명확히. |

---

## 3) 데이터 스키마(초기안)

초기 운영은 “마스터 데이터(관리)”와 “입력 데이터(현장)”를 분리하여 관리하는 것을 권장한다.

### (참고) 마스터 데이터 객체 구조 예시(JSON)

```jsx
{
  "library": "양천중앙도서관",
  "programs": [
    {
      "id": "p001",
      "name": "겨울방학 코딩 교실",
      "period": { "start": "2026-01-01", "end": "2026-02-28" },
      "days": "월, 수",
      "time": "14:00~16:00"
    }
  ]
}
```

- 위 구조는 “도서관 1개 → 운영 중 프로그램 목록”을 표현하기 위한 예시이며, 실제 저장소가 Google Sheets인 경우에는 조회 API에서 이 형태로 변환해 프론트에 제공한다.

### A. 마스터 데이터(관리자 관리용)

- **필수 컬럼(요구)**
    - 도서관명
    - 프로그램명
    - 기간(시작일, 종료일)
    - 요일
    - 시간
- **운영 규칙(권장)**
    - 도서관명은 11개 목록 중 선택만 가능(오타 방지)
    - 프로그램명은 도서관명과 조합하여 유일하게 식별될 수 있도록 관리(예: 동일명 프로그램이 존재할 경우 회차/기수 등 구분값 포함)

### B. 통계 입력 데이터(현장 입력용)

- **필수 컬럼(예시)**
    - 도서관명(마스터 기준 선택값)
    - 프로그램명(마스터 기준 선택값)
    - 회차/일시(마스터에서 자동 채움 또는 선택)
    - 모집 인원
    - 참여 인원
    - 노쇼 인원
    - 입력 시각(서버 기준)
    - 담당자 식별자(또는 연락처)
- **검증 규칙(예시)**
    - 참여 인원 ≤ 모집 인원
    - 노쇼 인원 ≤ 모집 인원
    - (선택) 참여 + 노쇼 ≤ 모집

---

원하시면 다음을 정해주면, 문서가 “내부 결재/보고”에 더 가까워집니다.

- 알림톡 발송 시점이 정확히 “종료 시간”인지, “종료 + 5분” 같은 버퍼가 필요한지
- 입력 수정 권한을 허용할지(허용한다면 “수정 가능 시간: 종료 후 24시간” 등 규칙)
- 대시보드가 보여줘야 하는 핵심 지표 Top 3 (예: 참여율, 노쇼율, 도서관별 누적 참여)