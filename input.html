<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>통계 입력 — 양천구립도서관</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="input_style.css">
</head>
<body>
  <div id="toast" class="toast" role="status" aria-live="polite"></div>
  <div class="page-wrap">
    <header class="header">
      <h1 class="title">프로그램 통계 입력</h1>
      <p class="subtitle">도서관과 프로그램을 선택한 뒤 참여 현황을 입력하세요.</p>
    </header>

    <main class="main">
      <form class="input-form glass" id="inputForm" novalidate>
        <div class="form-block">
          <label class="label" for="librarySelect">도서관</label>
          <select id="librarySelect" class="input-select" required aria-required="true">
            <!-- optgroups: 공공도서관 / 작은도서관 by input_script.js -->
          </select>
        </div>

        <div class="form-block">
          <label class="label" for="programSelect">프로그램</label>
          <select id="programSelect" class="input-select" disabled aria-disabled="true">
            <option value="">도서관을 먼저 선택하세요</option>
          </select>
          <div id="programDetail" class="program-detail" aria-live="polite"></div>
          <div id="currentSession" class="current-session"></div>
        </div>

        <div id="totalSessionsBlock" class="total-sessions-block glass" aria-live="polite" style="display: none;">
          <div class="total-sessions-inline">
            <span id="totalSessionsSummary" class="total-sessions-summary"></span>
            <div id="totalSessionsInputWrap" class="total-sessions-input-wrap" style="display: none;">
              <input type="number" id="totalSessionsInput" class="input-number total-sessions-input" min="1" inputmode="numeric" pattern="[0-9]*" placeholder="0" aria-label="총 운영 회수">
            </div>
          </div>
        </div>

        <section class="form-block form-block-numbers" aria-labelledby="numbersLabel">
          <h2 class="label" id="numbersLabel">참여 현황</h2>

          <div class="number-row number-row-recruit">
            <div class="number-field number-field-recruit" id="recruitWrap">
              <label class="number-label" for="recruitInput">모집(명)</label>
              <div class="recruit-input-row">
                <input type="number" id="recruitInput" class="input-number" min="0" inputmode="numeric" pattern="[0-9]*" placeholder="0" aria-label="모집(명)">
                <button type="button" id="recruitEditBtn" class="btn-edit btn-edit-compact" style="display: none;" aria-label="모집 인원 입력">수정</button>
              </div>
            </div>
            <div class="number-field">
              <label class="number-label" for="attendInput">참여(명)</label>
              <input type="number" id="attendInput" class="input-number" min="0" inputmode="numeric" pattern="[0-9]*" placeholder="0" aria-label="참여(명)">
              <span id="cumulativeAttend" class="cumulative-text" aria-live="polite">누적 참여: 0명</span>
            </div>
            <div class="number-field">
              <label class="number-label" for="noshowInput">노쇼(명)</label>
              <input type="number" id="noshowInput" class="input-number" min="0" inputmode="numeric" pattern="[0-9]*" placeholder="0" aria-label="노쇼(명)">
              <span id="cumulativeNoshow" class="cumulative-text" aria-live="polite">누적 노쇼: 0명</span>
            </div>
          </div>

          <div id="reasonBlock" class="reason-block" aria-hidden="true">
            <label class="number-label" for="reasonInput">인원 증액 사유 (예: 현장 추가 모집) <span class="required-dot">*</span></label>
            <input type="text" id="reasonInput" class="input-text" placeholder="예: 현장 추가 모집" maxlength="100" aria-required="true">
          </div>
        </section>

        <div class="form-block form-block-submit">
          <div class="submit-row">
            <button type="button" id="submitBtn" class="btn-submit">제출하기</button>
            <p id="finalSessionNotice" class="final-session-notice" aria-live="polite" style="display: none;">최종 회차 보고입니다</p>
          </div>
        </div>
      </form>

      <section class="history-section glass" aria-labelledby="historyTitle">
        <h2 class="history-title" id="historyTitle">이전 회차 운영 기록</h2>
        <ul id="historyList" class="history-list">
          <li class="history-empty">도서관과 프로그램을 선택하면 이전 회차 기록이 표시됩니다.</li>
        </ul>
      </section>

      <div id="completionPanel" class="completion-panel glass" aria-live="polite" style="display: none;">
        <p class="completion-message">전체 운영 보고가 완료되었습니다</p>
        <a href="index.html" id="dashboardLink" class="btn-dashboard">대시보드로 돌아가기</a>
      </div>
    </main>
  </div>

  <div id="modalOverlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="modalMessage" aria-hidden="true">
    <div class="modal-box glass">
      <div class="modal-checkmark" aria-hidden="true"></div>
      <p id="modalMessage" class="modal-message">데이터가 저장되었습니다</p>
      <button type="button" id="modalClose" class="btn-modal-close">확인</button>
    </div>
  </div>

  <div id="editHistoryModalOverlay" class="modal-overlay edit-history-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="editHistoryModalTitle" aria-hidden="true">
    <div class="modal-box glass edit-history-modal-box">
      <h2 id="editHistoryModalTitle" class="edit-history-modal-title">과거 회차 수정</h2>
      <div class="edit-history-form">
        <div class="form-block">
          <label class="label" for="editHistoryDate">날짜</label>
          <input type="date" id="editHistoryDate" class="input-text" aria-label="운영 날짜">
        </div>
        <div class="form-block">
          <label class="label" for="editHistoryRecruit">모집(명)</label>
          <input type="number" id="editHistoryRecruit" class="input-number" min="0" inputmode="numeric" pattern="[0-9]*" aria-label="모집(명)">
        </div>
        <div class="form-block">
          <label class="label" for="editHistoryAttend">참여(명)</label>
          <input type="number" id="editHistoryAttend" class="input-number" min="0" inputmode="numeric" pattern="[0-9]*" aria-label="참여(명)">
        </div>
        <div class="form-block">
          <label class="label" for="editHistoryNoshow">노쇼(명)</label>
          <input type="number" id="editHistoryNoshow" class="input-number" min="0" inputmode="numeric" pattern="[0-9]*" aria-label="노쇼(명)">
        </div>
        <div class="edit-history-actions">
          <button type="button" id="editHistoryCancel" class="btn-edit-history-cancel">취소</button>
          <button type="button" id="editHistorySave" class="btn-edit-history-save">저장</button>
        </div>
      </div>
    </div>
  </div>

  <script src="input_script.js"></script>
</body>
</html>
